\documentclass[titlepage, letterpaper, 11pt]{article}
\usepackage[letterpaper, margin=1.25in]{geometry}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{tablefootnote}
\begin{document}

\title{Multi-Stage Tuned Amplifier}
\author{By: Ben Lorenzetti\\
Team Member: Francois Nyamsi}
\date{Project Start Date: January 22, 2015\\
Report Submission Date: February 8, 2015}
\maketitle

\clearpage
\mbox{}
\thispagestyle{empty}
\clearpage
\setcounter{page}{1}

\tableofcontents

\section{Objective}

To compare the operation of common-emitter and common-base tuned
amplifier stages, and to design and characterize a multi-stage,
high-gain IF amplifier for 10 MHz operation with 50$\Omega$ input and
output impedances.

\clearpage
\section{Principles of Operation}

Tuned amplifiers are critical for electronic communications because
they increase the power of desired signal but reject other frequencies
as noise. At 10 MHz, a tuned amplifier could be used with an antenna
to recieve HF amateur radio from the other side of the world
\footnote{10 MHz waves can traverse the curve of the earth because
they get reflected by charged particles in the ionosphere, called
ionospheric skip propagation.},
or could be used in a computer to recieve 10Base-T ethernet.

There are three possible circuit configurations for bipolar junction
transistors (BJT) biased in forward-active mode, based on
which terminals are used for input, output, and common reference.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.75\textwidth]
		{figures/BJTforwardBiasConfigurations.png}
	\caption{
		Common-base (left), common-emitter (middle), and
		common-collector (right) configurations for BJT
		amplifiers.
	}
	\label{BJTforwardBiasConfigurations}
\end{figure}

Each configuration has its tradeoffs. The common-base (CB) configuration is
a good current buffer, with $A_{i}\approx1$ and low input impedance.
The common-emitter (CE) configuration offers the best overall power gain,
but $A_{v}$ and $A_{i}$ may vary with loadings. The common-collector
configuration is a good voltage buffer 
($A_{v}\approx1$) with low output impedance.

The three configurations can be cascaded together to gain the benefits
of each. If cascaded in the order shown in figure 
\ref{BJTforwardBiasConfigurations}, from left-to-right, the resulting
3-stage broadband amplifier would have low input impedance, good power
gain, and minimal output impedance.

A slight modification to the CE and CB configurations in figure
\ref{BJTforwardBiasConfigurations} can apply a filter to the broadband
amplifier; tuning the gain to a narrow frequency set by a tank circuit. 

Because BJTs are minority carrier devices, they act as current amplifiers
without being strongly affected by voltage. For the two configurations
where the output is at the collector (CB and CE), the BJT acts like a
dependent current source feeding the output load and the biasing
resistance $R_{C}$. As a result, the voltage gain for these
configurations is determined primarily by how difficult it is for
the collector current to reach ground; $A_{v}\propto R_{C}||R_{L}$.

One can take advantage of the collector current's obstinance
by replacing $R_{C}$ with an impedance that varies with frequency.
Using an inductor and a capacitor in parallel provides a short circuit
to ground for both DC and high frequency currents. Additionally, at the
LC circuit's resonant frequency, the net impedance $\rightarrow \infty$
due to power oscillating between the two.
\footnote{For this reason, an $L||C$ circuit is called a tank circuit.}
The result is a narrow bandpass filter at the resonant frequency, 
where $Z_{C}\rightarrow \infty$.

\section{Theory}

\subsection{Common-Base Broadband Amplifier}

The basic circuit for an single stage, common-base (CB) amplifier is
shown in figure \ref{commonBaseAmplifier}. The base terminal is
grounded and the input signal passes through the BJT from emitter
to collector. In this configuration, the BJT acts like a current
buffer, where the input current is repeated at the output regardless
of the load. 

\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth]
		{figures/commonBaseAmplifier.png}
	\caption{
		Basic circuit for a common-base broadband amplifier
		(left), its DC large signal (middle) equivalent, and
		AC small signal equivalent (right).
	}
	\label{commonBaseAmplifier}
\end{figure}

Two DC power rails are needed to bias the BJT in forward-active mode.
A positive supply holds the collector reverse biased
relative to the base which, at ground, is forward biased relative
to the negative supplied emitter. Quiescent point analysis of the
common-base is easy because the voltage is pinned at every node.

\begin{equation}
I_{EQ}=\frac{-V_{BE(on)}-V_{EE}}{R_{E}}
\label{commonBaseIeq}
\end{equation}

\begin{equation}
r_{\pi}=\frac{V_{th}}{I_{BQ}}
=\frac{V_{th}(\beta+1)R_{E}}{-V_{BE(on)}-V_{EE}}
\label{commonBaseRpi}
\end{equation}

\begin{equation}
g_{m}=\frac{\beta}{r_{\pi}}
=\frac{\alpha(-V_{BE(on)}-V_{EE})}{V_{th}R_{E}}
\end{equation}

The hybrid-$\pi$ model for small signal AC modeling is shown in the
right pane of figure \ref{commonBaseAmplifier}. Applying Kirchoff's
current law at node E can be used to find the input resistance.

\begin{equation*}
\textrm{KCL @ E:}\qquad
i_{S}-\frac{v_{s}}{r_{\pi}}-\frac{v_{s}}{R_{E}}-g_{m}v_{s}=0
\end{equation*}

\begin{equation*}
i_{s}=v_{s} \left[ \frac{1}{R_{\pi}}+\frac{1}{R_{E}}+g_{m} \right]
\end{equation*}

\begin{equation*}
i_{s}=v_{s} \left[
\frac{R_{E}+r_{\pi}+g_{m}r_{\pi}R_{E}}
{r_{\pi}R_{E}} \right]
\end{equation*}

\begin{equation*}
\frac{v_{s}}{i_{s}}
=\frac{r_{\pi}R_{E}}{R_{E}+r_{\pi}+g_{m}r_{\pi}R_{E}}
\end{equation*}

\begin{equation}
R_{in}=\frac{r_{\pi}}{\beta+1+\frac{r_{\pi}}{r_{E}}}
\label{commonBaseRin}
\end{equation}

Applying KCL at the collector can be used to calculate the voltage
gain of a single common-base stage.

\begin{equation*}
-g_{m}v_{s}+\frac{v_{o}}{R_{L}}+\frac{v_{o}}{R_{C}}=0
\end{equation*}

\begin{equation*}
v_{o}\left[\frac{R_{L}+R_{C}}{R_{L}R_{C}}\right]=g_{m}v_{s}
\end{equation*}

\begin{equation}
A_{v}=\frac{g_{m}R_{L}R_{C}}{R_{L}+R_{C}}
\end{equation}

\subsection{Common-Emitter Broadband Amplifier}

The basic circuit for an single stage, common-emitter (CE)
amplifier is shown in figure \ref{commonEmitterAmplifier}.
The DC equivalent circuit is shown in the left pane of figure
\ref{commonEmitterEquivalentCircuits}; the AC in the right.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.4\textwidth]
		{figures/commonEmitterAmplifier.png}
	\caption{
		Broadband Common-Emitter Stage
	}
	\label{commonEmitterAmplifier}
\end{figure}

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]
		{figures/commonEmitterEquivalentCircuits}
	\caption{
		Common-emitter equivalent circuits: DC (left),
		AC (right).
	}
	\label{commonEmitterEquivalentCircuits}
\end{figure}


\subsection{Coupling Capacitors}

The coupling capacitors, labeled $C_{Cx}$, isolate each stage from
direct currents but provide a low impedance path for the AC signal.
Taken together, they should form a sharp high-pass filter with its
corner frequency below 1000 Hz. The 3dB corner occurs when half the
signal power is dissipated in the capacitor and half in the stage's
input. This occurs when $Z_{Cc}=Z_{in}$.

\begin{equation*}
\frac{1}{|j\omega C|}=R_{in}
\end{equation*}

\begin{equation}
C_{C}\geq \frac{159.15\,\mu F*\Omega}{R_{in}}
\label{couplingCapacitors}
\end{equation}

\subsection{Tank Circuits}

No inductor is ideal. The quality of an inductor is defined by
the ratio of the impedance and resistance of the discrete element.
\begin{equation*}
Q=\frac{X_{L}}{R_{S}}\qquad\textrm{where}\qquad Z_{L}=R_{S}+jX_{L}
\end{equation*}

The series resistance $R_{S}$ is due to the resistivity of the
wire and the length used to wrap the coil. Furthermore, the
impedance $X_{L}$ is not 100\% inductive; there is a distributed
capacitance $C_{D}$ between the surfaces of the tightly wrapped
wire. The circuit model for an inductor is shown in the left pane of
figure \ref{tankCircuit}.

As a consequence of the distributed capacitance, every inductor
will have a self resonant frequency $f_{0}$, at which the energy
entering the tank will oscillate between the inductor and capacitor
instead of passing through.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.75\textwidth]
		{figures/tankCircuit.png}
	\caption{
		Circuit model for a non-ideal inductor (left) and its
		parallel equivalent circuit (right).
	}
	\label{tankCircuit}
\end{figure}

Sometimes the parallel equivalent of the imperfect L model is more
convenient. If the quality is greater than 5 the conversion is easy:
\begin{equation}
Q=\frac{X_{L}}{R_{S}}=\frac{R_{P}}{X_{L}}
\end{equation}

The self resonance frequency occurs when the net impedance is
greatest. Applying Kirchoff's current law to the parallel model...

\begin{equation*}
|I_{in}|=\frac{|V_{in}|}
{\sqrt{(j\omega L+1/j\omega C)^{2}+R_{P}^{2}}}
\end{equation*}

\begin{equation}
|Z_{L}|=\sqrt{R_{P}^{2}-\left(\omega L-\frac{1}{\omega C}\right)^{2}}
\end{equation}

One can see that $Z_{L}$ will reach its peak when:
\begin{equation*}
\left(\omega L-\frac{1}{\omega C}\right)=0
\label{resonantFrequencyEq}
\end{equation*}

Therefore, the maximum impedance of a tank circuit is:
\begin{equation}
|Z_{L}|_{max}=R_{P}\qquad\textrm{when}\qquad
f_{0}=\frac{1}{2\pi\sqrt{LC}}
\end{equation}

More generally than non-ideal inductors; the resonant frequency,
bandwidth, and quality of a parallel RLC circuit are related to 
L, C, and R.
\begin{equation}
Q=\frac{\omega_{0}}{B}=\omega_{0}RC=\frac{R}{\omega_{0}L}
\label{parallelRLCequation}
\end{equation}

\section{Design and Simulation}

\subsection{Specifications}

\subsection{Tank Circuits}

Two inductors were wound with \char`\~22 turns. Their inductance and quality
were measured using a Hewlett-Packard 4342A Q Meter. An appropriate
discrete capacitor and trimming capacitor were selected for both to
obtain a tank circuit with resonance at ~10 MHz. The fixed capacitors
were soldered to their inductors in parallel.

The soldered LC circuit were breadboarded in parallel with a trimming
capacitor and tuned. Then, the breadboarded tank circuit was measured
for net capacitance, resonance frequency, and quality using the HP
Q Meter. The methods for these measurements are attached in appendix
\ref{qMeter} and the results are shown in table
\ref{tankCircuitCharacteristics}.

\begin{table}[ht]
\centering
\caption{Tank Circuit Design and Measured Characteristics}
\begin{tabular}{c|c|c|c}
\hline\hline
Parameter	&1		&2	&Description	\\
\hline\hline
$L$		&$4.2\mu H$	&	&measured inductor	\\
$Q_{L}$		&		&	&on HP Q Meter	\\
\hline
$C_{target}$	&$90$		&	&from eq. \ref{resonantFrequencyEq}	\\
$C_{fixed}$	&$33pF$		&	&nominal value		\\
$C_{trim}$	&$5-35pF$	&	&approx. range		\\
\hline
$C_{d}$		&$55pF$		&	&measured LC circuit	\\
$f_{0}$		&$13.3MHz$	&	&on HP Q Meter,		\\
$Q$		&$85.5$		&	&see \ref{qMeter}	\\
$R_{p}$		&$30k\Omega$	&	&from eq. \ref{parallelRLCequation}	\\
\hline\hline
\end{tabular}
\label{tankCircuitCharacteristics}
\end{table}

\subsection{Common-Base Stage}

The first stage must be a common-base amplifier in order to achieve
low input resistance. The emitter resitance must be
chosen to achieve desirable input resistance and voltage gain.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.25\textwidth]
		{figures/commonBaseStage}
	\caption{
		Common-base stage with SPICE netlist labels.
	}
	\label{commonBaseStage}
\end{figure}


It is clear that $R_{in}$ is strongly related to $r_{\pi}$ from
equation \ref{commonBaseRin}. Substituting equation
\ref{commonBaseRpi} for $r_{\pi}$ into equation \ref{commonBaseRin}
yields

\begin{equation*}
R_{in}=\frac{-V_{th}R_{E}}{V_{BE(on)}+V_{EE}}
\qquad\textrm{or}\qquad
\left(R_{E}=\frac{R_{in}(-V_{BE(on)}-V_{EE})}{V_{th}}\right)
\end{equation*}

Using the specified value for $V_{EE}$ and $R_{in}$, and typical
values for $V_{th}$ and $V_{BE(on)}$, the emitter resitance should be

\begin{equation*}
R_{E}=\frac{50\Omega(-0.7V+12V)}{0.0259V}=21.8k\Omega
\end{equation*}

With $R_{E}$, the quiescent current can be calculated with equation
\ref{commonBaseIeq}; $I_{EQ}=0.52mA$.

The first BJT was characterized and a DC load line drawn. Because all
of the node voltages are pinned, the load line is vertical; $V_{CE}$
is independent of $I_{EQ}$. It was found that
\begin{equation*}
\beta_{Q1}=176\qquad\qquad V_{AQ1}=452V
\end{equation*}

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\textwidth]
		{measurements/q1Characteristics}
	\caption{
		Q1 Current-Voltage Characteristics and DC Load Line
	}
	\label{q1Characteristics}
\end{figure}

From equation \ref{couplingCapacitors} and using $R_{in}=50\Omega$,

\begin{equation*}
C_{C1}\geq 3.183pF
\end{equation*}

At this point, all of the discrete components for the CB stage have
been determined. A SPICE simulation was performed to check the
performance of the stage. For a load value, the input resistance of
the first common emitter stage was used. The netlist used is included
in appendix \ref{CBstageNetlist} and the results are shown in figure
\ref{CBstageMagnitudePlot}.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\textwidth]
		{ngspice/CBstage.eps}
	\caption{
		Magnitude Gain of Common-Base Stage, in dB
	}
	\label{CBstageMagnitudePlot}
\end{figure}

\subsection{Common-Emitter Stage}

The common-emitter configuration provides the highest overall power
gain, compared to CB and CC. This makes it ideal for the middle
stages. A single CE stage is shown in figure 
\ref{commonEmitterStage}.

The second BJT was characterized on the Tektronix Curve Tracer
using a range of 20V and 2mA (the maximum swing would actually be
24V). The i-v characteristics and the DC load line are shown in
figure \ref{q2Characteristics}.

The MATLAB analysis of $A_{v}(I_{EQ})$ in section
\ref{gainVSquiescentCurrent} showed that the gain of a CE amplifier
grows proportionally to the quiescent current. Based on this, a
relatively large quiescent current was chosen, ????.

\section{Appendices}

\subsection{HP 4342A Q Meter}
\label{qMeter}

The following 3 pages are taken from the HP 4342A Q Meter Operating
and Service Manual, pages 35-37.

\includegraphics[width=1\textwidth]{qMeter/page35}

\includegraphics[width=1\textwidth]{qMeter/page36}

\includegraphics[width=1\textwidth]{qMeter/page37}

\subsection{Common-Base SPICE Netlist}
\label{CBstageNetlist}

The following netlist was used to simulate the CB stage. The labeling
in the netlist corresponds to the circuit in figure
\ref{commonBaseStage}.

\begin{verbatim}
*** CBstage.cir ***
* Nodes:
* gnd, cc (+12V), ee (-12V), s, in, e1, c1, out

Vcc cc gnd dc 12V ac 0V
Vee ee gnd dc -12V ac 0V
Vs s gnd dc 0V ac 10mV
Rs in s 50
Cc1 in e1 3.183uF
Re1 e1 ee 21.8k
Q1 c1 gnd e1 model1
L1 c1 cc 4.2uH
Cd1 c1 cc 55pF
Rp1 c1 cc 2.18k
Cc2 c1 out 3.183uF
Rld out gnd 9999k

* .model <name> <type> (par1=value1 par2=value2 ...)
* VAF = forward Early voltage
* BF = forward beta; forward common-emitter gain
* CJE = base-emitter zero-bias junction capacitance
* CJC = base-collector zero-bias junction capacitance
* TS = transport saturation current
* NF = forward mode ideality factor

.model model1 npn (BF=176 CJC=20pf CJE=20pf IS=1E-16 VAF=452V NF=1)

.control
set filetype=ascii
ac dec 10 1Hz 1GHz
plot db(v(out)/v(in))
plot ph(v(out))-ph(v(in))
write CBstage.txt db(v(output)/v(input)) ph(v(output))-ph(v(input))
\end{verbatim}


\end{document}
